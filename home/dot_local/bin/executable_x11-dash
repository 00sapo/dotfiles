#!/bin/env bash

# rofi grabs all keyboard input, so we need to have an internal rofi keybinding for closing it
# however, when rofi is closed, Super_L is also sent to the window manager, which toggles the
# overview mode again. To avoid this, we use a state file to ignore the second toggle. The trick is
# to change the state back to "stopped" after a short delay, so that the next time this script
# is run in a short time, it will be ignored.

state=$(cat $HOME/.cache/x11-dash-state.txt)
if [ "$state" != "started" ]; then
  echo "started" >$HOME/.cache/x11-dash-state.txt
  wmctrl -k on
  xfconf-query -c xfce4-panel -p /panels/panel-1/autohide-behavior -s 0 # show the panel
  rofi -show combi -kb-cancel 'Super_L' -location 2
  wmctrl -k off
  xfconf-query -c xfce4-panel -p /panels/panel-1/autohide-behavior -s 2 # hide the panel
  sleep 0.2                                                             # this is the trick
  echo "stopped" >$HOME/.cache/x11-dash-state.txt
fi
