#!/bin/env bash

/usr/local/bin/devbox "$@"

for i in "$HOME"/.local/share/devbox/global/default/.devbox/nix/profile/default/share/applications/*.desktop; do
  sed "s/Exec=/Exec=\/usr\/local\/bin\/devbox global run /" "$i" >"$HOME"/.local/share/applications/"$(basename "$i")"
done

for i in "$HOME"/.local/share/applications/*.desktop; do
  # take the first word of the Exec= line
  exec="$(grep -oP '^Exec=\K[^ ]+' "$i")"
  # check if the first word doesnt exists as a command in the path
  for exec in $exec; do
    if ! command -v "$exec" &>/dev/null; then
      echo "$i should be removed because $exec doesn't exists"
    fi
  done
done
